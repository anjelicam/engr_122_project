---
title: The Relationship Between Air Pollution and Mobility of Individuals Following
  COVID-19 Related Shelter-in-Place Orders
author: "Anjelica Martinez, Joanna Rashid, Yousif Alnuaimi"
date: "05/08/2020"
output:
  html_document:
    df_print: paged
  html_notebook:
    fig_height: 4
    fig_width: 6
    highlight: null
    theme: flatly
  pdf_document: default
---

<style type="text/css">
.main-container {
  max-width: 1800px;
  margin-left: auto;
  margin-right: auto;
}
</style>

## Introduction

The historic COVID-19 pandemic has caused nearly 50% of the world population to be subject to government “stay-at-home” and self-isolation orders. This sudden, drastic reduction in the mobility of the population has generated a natural experiment that tests the effect a near halt of mobility for individuals and drastic reduction of commercial operations would have on air quality. The metric used for this study is the mean daily mobility of individuals in a given US county.
  
Based on this criteria, we selected five major counties that had the highest level of mobility reduction as well as five other counties that didn’t have much reduction in mobility. A major county is defined as being in the top 40 most populous counties in the US, per the US Census Bureau. The time period of this study is February 28 through March 27, which is the time during which some US counties enacted “shelter-in-place” and the self-isolation orders to control the community spread of COVID-19.  The five counties with the greatest reduction in citizen mobility issued “shelter-in-place” orders during this period.

The five counties with the least mobility reduction had no “shelter-in-place” orders during the studied time period and can serve as a control group. The finding of this data visualization study will serve to convey the quantity of air pollution generated by the mobility individuals alone.

### Counties of Interest

Counties that decreased mobility **98-100%** between Feb. 28 and Mar. 27, 2020. [New York Times](https://www.nytimes.com/interactive/2020/04/02/us/coronavirus-social-distancing.html).

* Arlington, VA
* District of Columbia, DC
* New York, NY
* San Francisco, CA
* Santa Clara, CA

Most populous counties that decreased mobility **30% or less** between between Feb. 28 and Mar. 27, 2020 [New York Times](https://www.nytimes.com/interactive/2020/04/02/us/coronavirus-social-distancing.html).

* Miami-Dade, FL
* Dallas, TX
* Harris, TX
* Maricopa, AZ
* San Bernardino County, CA

### Libraries/Packages Used
The libraries that we used for this project are the following:
```{r Libraries, message=FALSE, warning=FALSE}
library(easypackages)
libraries("gridExtra", "viridis", "tidyverse", "plotly", "hrbrthemes", "htmlwidgets", "ggpubr", "scales")
```

### Data Source
Finalized data prep `.Rdata` file containing all values and counties of interest
```{r Data Load, message=FALSE, warning=FALSE}
load("data/tidy/tidy_mobility_vs_aqi.RData")
```

## Exploratory Data Analyses
The three datasets we worked with are:

* `df`: AQI, mobility index, and pollutant values for the 10 counties of interest
* `high_mobility`: counties that decreased mobility 98-100% between Feb. 28 to Mar. 27
* `low_mobility`: counties decreased mobility 30% or less between Feb. 28 to Mar. 27

### Definitions Review
* `m50`: The median of the max-distance mobility for all samples in the specified region.
* `m50_index`: The percent of normal m50 in the region, with normal m50 defined during 2020-02-17 to 2020-03-07.
* `AQI`: Average air quality index for that day
* `Pollutant names (e.g. Ozone, PM25)`: average daily value
* `main_pollutant`: Represents which pollutant was the main pollutant contributing to AQI

```{r Tables, message=FALSE, warning=FALSE, paged.print=TRUE}
head(df)
head(high_mobility)
head(low_mobility)
```

## Overview: Time Series Plots
To get a quick visual overview, we two seperate time series plots: mobilty vs time, and aqi vs time.

### Mobility Index Over Time Series Plot
Here we plotted the mobility (`m50_index`) for each county from March 1st to April 18th, 2020. You can see how quickly mobility dropped for the counties that implemented shelter-in-place procedures promptly versus the counties that took longer.
```{r Time Series Plots, message=FALSE, warning=FALSE, fig.width=15, fig.height=12, dpi=300}

# Counties that decreased mobility 98-100% between Feb. 28 to Mar. 27
high_mobility_plot <- ggplot(high_mobility, aes(x = date, y = m50_index, fill = county)) +
                       geom_area() +
                       scale_fill_viridis(discrete = TRUE) +
                       theme(legend.position = "none") +
                       labs(
                         title = "Counties that decreased mobility 98-100% between Feb. 28 to Mar. 27",
                         x = "Date",
                         y = "Mobility Index") +
                       scale_x_date(date_labels = "%b %d", date_breaks = "1 week") +
                       scale_y_continuous(breaks = seq(0, 200, by = 20)) +
                       theme_ipsum() +
                       theme(
                             legend.position = "none",
                             panel.spacing = unit(0, "lines"),
                             strip.text.x = element_text(size = 10),
                             plot.title = element_text(size = 13)) +
                       facet_wrap(county ~ ., ncol = 1)

# Counties that decreased mobility 30% or less between Feb. 28 to Mar. 27
low_mobility_plot <- ggplot(low_mobility, aes(x = date, y = m50_index, fill = county)) +
                       geom_area() +
                       scale_fill_viridis(discrete = TRUE, option = "plasma") +
                       theme(legend.position = "none") +
                       labs(title = "Counties that decreased mobility 30% or less between Feb. 28 to Mar. 27",
                            x = "Date",
                            y = "Mobility Index") +
                       scale_x_date(date_labels = "%b %d", date_breaks = "1 week") +
                       scale_y_continuous(breaks = seq(0, 200, by = 20)) +
                       theme_ipsum() +
                       theme(
                             legend.position = "none",
                             panel.spacing = unit(0, "lines"),
                             strip.text.x = element_text(size = 10),
                             plot.title = element_text(size = 13)) +
                       facet_wrap(county ~ ., ncol = 1)

# Show both plots side by side
grid.arrange(high_mobility_plot, low_mobility_plot, ncol = 2)
```

### Air Quality Index Time Series Plots
Here we plotted the daily average air quality index (`aqi`) for each county from March 1st to April 18th, 2020.

```{r AQI Time Series, fig.height=12, fig.width=15, message=FALSE, warning=FALSE, dpi=300}

# Counties that decreased mobility 98-100% between Feb. 28 to Mar. 27
high_mobility_aqi <- ggplot(high_mobility, aes(x = date, y = aqi, fill = county)) +
                       geom_area() +
                       scale_fill_viridis(discrete = TRUE) +
                       theme(legend.position = "none") +
                       labs(title = "Counties that decreased mobility 98-100% between Feb. 28 to Mar. 27",
                            x = "Date", 
                            y = "Air Quality Index") +
                       scale_x_date(date_labels = "%b %d") +
                       scale_y_continuous(limits = c(0, 100),
                                          breaks = seq(0, 100, by = 20)) +
                       theme_ipsum() +
                         theme(
                           legend.position = "none",
                           panel.spacing = unit(0, "lines"),
                           strip.text.x = element_text(size = 8),
                           plot.title = element_text(size = 13)) +
                       facet_wrap(county ~ ., ncol = 1)

# Counties that decreased mobility 30% or less between Feb. 28 to Mar. 27
low_mobility_aqi <- ggplot(low_mobility, aes(x = date, y = aqi, fill = county)) +
                     geom_area() +
                     scale_fill_viridis(discrete = TRUE, option = "plasma") +
                     theme(legend.position = "none") +
                     labs(title = "Counties that decreased mobility 30% or less between Feb. 28 to Mar. 27", 
                          x = "Date", 
                          y = "Air Quality Index") +
                     scale_x_date(date_labels = "%b %d") +
                     scale_y_continuous(breaks = seq(0, 100, by = 20)) +
                     theme_ipsum() +
                     theme(
                       legend.position = "none",
                       panel.spacing = unit(0, "lines"),
                       strip.text.x = element_text(size = 8),
                       plot.title = element_text(size = 13)) +
                     facet_wrap(county ~ ., ncol = 1)

# Show both plots side by side
grid.arrange(high_mobility_aqi, low_mobility_aqi, ncol = 2)

```

### AQI vs. Mobility for Each County

### Correlation Scatterplot
Ran this to see corr. coef, and p-value, and visually see the data
```{r Correlation Scatterplot, fig.asp=.35, fig.width=20, message=FALSE}

# Correlation scatterplot for all 10 counties
ggscatter(df, x = "aqi", 
          y = "m50_index", 
          color = "county",
          palette = c("#440154", "#0d0887", "#3b528b", "#7e03a8", "#cc4678", 
                      "#f89441", "#21908c", "#f0f921", "#5dc863", "#fde725"),
          add = "reg.line", 
          conf.int = TRUE, 
          cor.coef = TRUE,
          cor.method = "pearson",
          title = "Relationship Between Air Quality and Mobility",
          xlab = "Air Quality Index", 
          ylab = "Mobility Index",
          add.params = list(color = "red",
                            fill = "lightgray")) +
          facet_wrap(~county,
                     ncol = 5,
                     scales = "free") +
          theme(legend.position = "none")
```

### Correlation Test of Mobility vs AQI per County

```{r Pearsons Correlation Test, message=FALSE, warning=FALSE}
results = list() # Prep a list to store your corr.test results
counter = 0 # To store your corr.test into list through iterating

for (i in unique(df$county))
{
  counter = counter + 1
  # Creates x and y values for cor.test()
  x = as.numeric(df[df$county == i,]$aqi)
  y = as.numeric(df[df$county == i,]$m50_index)
  
  results[[i]] <- cor.test(x, y, method = "pearson") # correlation test
}
results
```
### Interpretation
Based on these data the counties with significant results are Harris, weak negative correlation (*r* = -0.35, *p* = .016), Maricopa weak negative correlation(*r* = -0.54, *p* < .001), and New York weak negative correlation (*r* = -.36, *p* = .011). However, each county The other counties results were no significant.

## Double Y-Axis Plot Time Series of Mobility vs AQI for counties with significant p-values
We ploted a double Y-axis time series plot to see how mobility and aqi changed over time for the three counties with significant findings.

```{r Mobility & AQI Time Series, message=FALSE, warning=FALSE, fig.asp=.3, fig.width=13}
# Significant Counties dataframe
sig_counties_values <- filter(df, county %in% c("Harris", "Maricopa", "New York")) %>% select(date, county, aqi, m50_index)

# Color values
aqi_color <- "#69b3a2"
mobility_color <- rgb(0.2, 0.6, 0.9, 1)

# Significant Counties Double y-axis Plot
ggplot(sig_counties_values, aes(x = date)) +
  geom_line(aes(y = aqi), size = 1, color = aqi_color) + 
  geom_line(aes(y = m50_index), size = 1, color = mobility_color) +
  xlab("Date") +
  scale_y_continuous(
    name = "Air Quality Index",
    sec.axis = sec_axis(~ ., name = "Mobility Index")) + 
  facet_wrap(~county, ncol = 3) +
  theme_ipsum() +
  theme(
    axis.title.y = element_text(color = aqi_color, size = 13),
    axis.title.y.right = element_text(color = mobility_color, size = 13)) +
  ggtitle("Air Quality Increases as Mobility Decreases")
```

```{r Sigfificant Counties Correlation, message=FALSE, warning=FALSE, fig.asp = .3, fig.width= 15}
ggscatter(sig_counties_values, x = "aqi", y = "m50_index", color = "county",
          palette = c("#7e03a8", "#cc4678", "#21908c"),
          add = "reg.line", 
          conf.int = TRUE, 
          cor.coef = TRUE, 
          cor.method = "pearson",
          title = "Relationship Between Air Quality and Mobility",
          xlab = "Air Quality Index", 
          ylab = "Mobility Index",
          add.params = list(color = "red",
                            fill = "lightgray")) +
          facet_wrap(~county, ncol = 3, scales = "free_x") +
          theme(legend.position = "none")
```

## Conclusion
The COVID-19 crisis resulted in extensive "shelter-in-place" orders worldwide in order to reduce transmission of the virus. In the United States, shelter-in-place orders were left up to the states and governing local governments to decide when to shelter-in-place and for how long. Because of this, we have data from places where the shelter-in-place was declared earlier than others, which corresponding data of possible effects of this in relation to air quality and mobility.

Numerous news sources reported pollution decreases around the world, including [Los Angeles noticeable decrease in visual smog](https://www.businessinsider.com/photos-stay-at-home-order-reduced-los-angeles-notorious-smog-2020-4) and [Italy's crystal clear Venice canals](https://www.insider.com/satellite-images-venice-canals-clear-coronavirus-lockdown-2020-4). Much speculation surrounds the reason for the decrease in pollution and whether it is related to shelter-in-place orders. 

We hypothesized that there would be a statistically significant relationship between air quality and mobility. Our results show that there is a weak negative correlation between mobility and air quality for Harris County (*r* = -0.35, *p* = .016), Maricopa County (*r* = -0.35, *p* = .016), and New York County (*r* = -0.35, *p* = .016) only. The remaining counties results were not significant and no conclusions can be made on the relationship between mobility and air quality.

## Future Study Recommendations
Because we focused on the 10 counties reported in the news article, we believe that future researchers should look into reviewing air quality levels, pollutant levels, and mobility information for all counties across the United States to get a clearer and possibly better picture of the relationship between mobility and pollution/air quality. An additional important aspect may be to observe the effects of industrial pollutant output levels and whether they had any influence on general air quality during the pandemic.